<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HCL Config Linter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .input-section, .output-section {
            padding: 30px;
            display: flex;
            flex-direction: column;
        }

        .input-section {
            border-right: 1px solid #e5e7eb;
            background: #f8fafc;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 20px;
            height: 20px;
        }

        .editor-container {
            flex: 1;
            position: relative;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .editor-container:focus-within {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .editor-wrapper {
            display: flex;
            height: 100%;
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            position: relative;
        }

        .line-numbers {
            background: #f8fafc;
            border-right: 1px solid #e5e7eb;
            color: #9ca3af;
            padding: 20px 12px 20px 20px;
            user-select: none;
            min-width: 60px;
            text-align: right;
            white-space: pre;
            overflow: hidden;
            position: relative;
            z-index: 2;
        }

        .line-highlight {
            position: absolute;
            left: 0;
            right: 0;
            pointer-events: none;
            z-index: 1;
            transition: all 0.2s ease;
            opacity: 0;
        }

        .line-highlight.error {
            background: rgba(239, 68, 68, 0.15);
            border-left: 3px solid #ef4444;
        }

        .line-highlight.warning {
            background: rgba(251, 191, 36, 0.15);
            border-left: 3px solid #fbbf24;
            /* Ensure no additional margin/padding differences */
            margin: 0;
            padding: 0;
        }

        .line-highlight.active {
            opacity: 1;
        }

        textarea {
            flex: 1;
            border: none;
            padding: 20px;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            background: transparent;
            resize: none;
            outline: none;
            white-space: pre;
            overflow-wrap: normal;
            overflow-x: auto;
            position: relative;
            z-index: 2;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            align-items: center;
        }

        button {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .clear-btn {
            background: linear-gradient(135deg, #ef4444, #f97316);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .clear-btn:hover {
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .results {
            flex: 1;
            background: #1f2937;
            color: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.6;
            overflow-y: auto;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status.valid {
            background: #dcfce7;
            color: #166534;
        }

        .status.error {
            background: #fef2f2;
            color: #dc2626;
        }

        .error {
            color: #fca5a5;
            margin: 10px 0;
            padding: 10px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 6px;
            border-left: 4px solid #ef4444;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .error:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: translateX(2px);
        }

        .warning-item {
            color: #fbbf24;
            margin: 5px 0;
            padding: 8px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .warning-item:hover {
            background: rgba(251, 191, 36, 0.2);
            transform: translateX(2px);
        }

        .success {
            color: #86efac;
            padding: 15px;
            background: rgba(34, 197, 94, 0.1);
            border-radius: 6px;
            border-left: 4px solid #22c55e;
        }

        .example-btn {
            background: linear-gradient(135deg, #059669, #0891b2);
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
            font-size: 14px;
            padding: 10px 20px;
        }

        .example-btn:hover {
            box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #e5e7eb;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-wrap: wrap;
            }
        }

        .lint-info {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 15px;
            padding: 10px;
            background: #f3f4f6;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>HCL Config Linter</h1>
            <p>Paste your HashiCorp Configuration Language (HCL) code to check for syntax errors</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">
                    <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                    </svg>
                    HCL Configuration Input
                </h2>
                
                <div class="lint-info">
                    <strong>Comprehensive HCL Validation:</strong> 
                    Advanced regex-based validation covering HCL v2 syntax, Terraform constructs, and common configuration errors.
                    <br><br>
                    <strong>Features:</strong> Bracket matching, string validation, block syntax checking, interpolation detection, and Terraform-specific warnings
                </div>
                
                <div class="editor-container">
                    <div class="editor-wrapper">
                        <div class="line-numbers" id="lineNumbers">1</div>
                        <div class="line-highlight" id="lineHighlight"></div>
                        <textarea 
                            id="hclInput" 
                            placeholder="Paste your HCL configuration here...

Example:
resource &quot;aws_instance&quot; &quot;web&quot; {
  ami           = &quot;ami-0c55b159cbfafe1d0&quot;
  instance_type = &quot;t2.micro&quot;
  
  tags = {
    Name = &quot;HelloWorld&quot;
  }
}"
                            spellcheck="false"></textarea>
                    </div>
                </div>
                
                <div class="controls">
                    <button id="lintBtn">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 6px;">
                            <path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01L10.067.87zm-3.2 8.5a.5.5 0 0 1 .708 0l1.5 1.5a.5.5 0 0 1-.708.708L7 10.207 5.707 11.5a.5.5 0 0 1-.708-.708l1.5-1.5z"/>
                        </svg>
                        Lint HCL
                    </button>
                    <button id="clearBtn" class="clear-btn">Clear</button>
                    <button id="exampleBtn" class="example-btn">Load Example</button>
                </div>
            </div>
            
            <div class="output-section">
                <h2 class="section-title">
                    <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                    </svg>
                    Lint Results
                </h2>
                
                <div id="results" class="results">
                    <div style="text-align: center; margin-top: 50px; color: #9ca3af;">
                        <svg width="48" height="48" fill="currentColor" viewBox="0 0 16 16" style="margin-bottom: 15px;">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                        </svg>
                        <p>Enter HCL configuration above and click "Lint HCL" to check for syntax errors</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script>
        <!-- GitHub Corner -->
        <a href="https://github.com/traefikturkey/onepage" class="github-corner" aria-label="View source on GitHub" target="_blank" rel="noopener">
            <svg width="80" height="80" viewBox="0 0 250 250"
                     style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
                     aria-hidden="true">
                <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
                <path d="M128.3,109.0 ... (SVG code for the Octocat arm and body) ..." fill="currentColor" style="transform-origin: 130px 106px;"></path>
            </svg>
        </a>
        <!-- End GitHub Corner -->
        // Load the HCL parser WebAssembly module
        let hclParser = null;
        let parserLoading = false;
        
        async function loadHCLParser() {
            if (hclParser || parserLoading) return hclParser;
            parserLoading = true;
            
            try {
                // Try multiple CDN sources for the HCL parser
                const cdnUrls = [
                    'https://unpkg.com/@seatgeek/node-hcl@latest/dist/index.js',
                    'https://cdn.jsdelivr.net/npm/@seatgeek/node-hcl@latest/dist/index.js',
                    'https://cdn.skypack.dev/@seatgeek/node-hcl'
                ];
                
                let lastError = null;
                for (const url of cdnUrls) {
                    try {
                        console.log(`Trying to load HCL parser from: ${url}`);
                        const module = await import(url);
                        hclParser = module;
                        console.log('HCL parser loaded successfully from:', url);
                        return hclParser;
                    } catch (error) {
                        console.warn(`Failed to load from ${url}:`, error.message);
                        lastError = error;
                        continue;
                    }
                }
                
                throw lastError || new Error('All CDN sources failed');
                
            } catch (error) {
                console.error('Failed to load HCL parser from all sources:', error);
                console.log('Falling back to basic validation');
                // Fallback to basic validation if WebAssembly fails
                hclParser = null;
                return null;
            } finally {
                parserLoading = false;
            }
        }

        // Initialize parser on page load and update status
        loadHCLParser().then(() => {
            const statusDiv = document.getElementById('parserStatus');
            if (hclParser) {
                statusDiv.innerHTML = '✅ Official HashiCorp parser loaded - Maximum accuracy validation';
                statusDiv.style.color = '#059669';
            } else {
                statusDiv.innerHTML = '⚠️ Using fallback validation - WebAssembly parser unavailable';
                statusDiv.style.color = '#d97706';
            }
        });
        // Enhanced HCL linting using HashiCorp's official parser via WebAssembly
        async function lintHCL(hclCode) {
            if (!hclCode.trim()) {
                return { valid: false, errors: ['Empty configuration'], warnings: [] };
            }

            const errors = [];
            const warnings = [];

            // Try to use the official HCL parser first
            if (hclParser) {
                try {
                    const result = await hclParser.parseHCL(hclCode);
                    
                    if (result.errors && result.errors.length > 0) {
                        result.errors.forEach(error => {
                            // Format the error message with line information
                            const lineInfo = error.range ? ` (Line ${error.range.start.line + 1})` : '';
                            errors.push(`${error.detail || error.summary}${lineInfo}`);
                        });
                    }
                    
                    if (result.diagnostics && result.diagnostics.length > 0) {
                        result.diagnostics.forEach(diagnostic => {
                            const lineInfo = diagnostic.range ? ` (Line ${diagnostic.range.start.line + 1})` : '';
                            if (diagnostic.severity === 'warning') {
                                warnings.push(`${diagnostic.detail || diagnostic.summary}${lineInfo}`);
                            } else {
                                errors.push(`${diagnostic.detail || diagnostic.summary}${lineInfo}`);
                            }
                        });
                    }
                    
                    // If no errors from the official parser, it's valid HCL
                    if (errors.length === 0) {
                        return { valid: true, errors: [], warnings };
                    }
                    
                    return { valid: false, errors, warnings };
                    
                } catch (parserError) {
                    console.warn('HCL parser failed, falling back to basic validation:', parserError);
                    // Fall through to basic validation
                }
            }

            // Fallback to basic validation if WebAssembly parser isn't available
            return basicHCLValidation(hclCode);
        }

        // Basic HCL validation (fallback)
        function basicHCLValidation(hclCode) {
            const errors = [];
            const warnings = [];
            
            const lines = hclCode.split('\n');
            
            // Track bracket balance
            let braceBalance = 0;
            let bracketBalance = 0;
            let parenBalance = 0;
            
            // Track quotes
            let inString = false;
            let stringChar = null;
            
            for (let lineNum = 0; lineNum < lines.length; lineNum++) {
                const line = lines[lineNum];
                const trimmedLine = line.trim();
                
                // Skip empty lines and comments
                if (!trimmedLine || trimmedLine.startsWith('#') || trimmedLine.startsWith('//')) {
                    continue;
                }
                
                // Check for common syntax patterns
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    const prevChar = i > 0 ? line[i-1] : null;
                    
                    // Handle strings
                    if ((char === '"' || char === "'") && prevChar !== '\\') {
                        if (!inString) {
                            inString = true;
                            stringChar = char;
                        } else if (char === stringChar) {
                            inString = false;
                            stringChar = null;
                        }
                        continue;
                    }
                    
                    // Skip characters inside strings
                    if (inString) continue;
                    
                    // Track brackets
                    switch (char) {
                        case '{': braceBalance++; break;
                        case '}': braceBalance--; break;
                        case '[': bracketBalance++; break;
                        case ']': bracketBalance--; break;
                        case '(': parenBalance++; break;
                        case ')': parenBalance--; break;
                    }
                    
                    // Check for negative balances
                    if (braceBalance < 0) {
                        errors.push(`Line ${lineNum + 1}: Unexpected closing brace '}'`);
                        braceBalance = 0;
                    }
                    if (bracketBalance < 0) {
                        errors.push(`Line ${lineNum + 1}: Unexpected closing bracket ']'`);
                        bracketBalance = 0;
                    }
                    if (parenBalance < 0) {
                        errors.push(`Line ${lineNum + 1}: Unexpected closing parenthesis ')'`);
                        parenBalance = 0;
                    }
                }
                
                // Check for unterminated strings
                if (inString) {
                    errors.push(`Line ${lineNum + 1}: Unterminated string literal`);
                    inString = false;
                    stringChar = null;
                }
                
                // Basic HCL syntax checks
                if (trimmedLine.includes('=')) {
                    const parts = trimmedLine.split('=');
                    if (parts.length >= 2) {
                        const key = parts[0].trim();
                        const value = parts.slice(1).join('=').trim();
                        
                        // Check for invalid key names
                        if (!key.match(/^[a-zA-Z_][a-zA-Z0-9_-]*$/)) {
                            if (!key.includes('"') && !key.includes('[')) {
                                errors.push(`Line ${lineNum + 1}: Invalid attribute name '${key}'`);
                            }
                        }
                        
                        // Check for missing values
                        if (!value) {
                            errors.push(`Line ${lineNum + 1}: Missing value for attribute '${key}'`);
                        }
                    }
                }
                
                // Check block syntax (resource, data, etc.)
                const blockMatch = trimmedLine.match(/^(resource|data|variable|output|locals|module|provider|terraform)\s+/);
                if (blockMatch) {
                    const blockType = blockMatch[1];
                    const afterKeyword = trimmedLine.substring(blockMatch[0].length);
                    
                    if (blockType === 'resource' || blockType === 'data' || blockType === 'module') {
                        // These blocks need type and name
                        if (!afterKeyword.includes('"') || afterKeyword.split('"').length < 4) {
                            errors.push(`Line ${lineNum + 1}: ${blockType} block requires type and name parameters`);
                        }
                    }
                }
                
                // Check for trailing commas (common error)
                if (trimmedLine.endsWith(',') && !trimmedLine.includes('[') && !inString) {
                    warnings.push(`Line ${lineNum + 1}: Trailing comma might cause issues`);
                }
            }
            
            // Final balance checks
            if (braceBalance > 0) {
                errors.push(`Missing ${braceBalance} closing brace(s) '}'`);
            }
            if (bracketBalance > 0) {
                errors.push(`Missing ${bracketBalance} closing bracket(s) ']'`);
            }
            if (parenBalance > 0) {
                errors.push(`Missing ${parenBalance} closing parenthesis ')'`);
            }
            
            return {
                valid: errors.length === 0,
                errors,
                warnings
            };
        }

        // Function to highlight a specific line
        function highlightLine(lineNumber, type) {
            const highlight = document.getElementById('lineHighlight');
            const textarea = document.getElementById('hclInput');
            
            if (lineNumber && lineNumber > 0) {
                // Use the same font metrics as the textarea
                const fontSize = 14; // matches CSS
                const lineHeight = 1.5; // matches CSS
                const actualLineHeight = fontSize * lineHeight; // 21px
                const paddingTop = 20; // matches CSS padding
                
                // Apply different adjustments for warnings since they seem to behave differently
                let adjustmentOffset;
                if (type === 'error') {
                    adjustmentOffset = -9; // Move errors down 1 pixel
                } else if (type === 'warning') {
                    adjustmentOffset = 1; // Move warnings down 1 pixel
                } else {
                    adjustmentOffset = -9; // Default
                }
                
                // Calculate position
                const topOffset = paddingTop + (lineNumber - 1) * actualLineHeight + adjustmentOffset;
                
                highlight.style.top = `${topOffset - textarea.scrollTop}px`;
                highlight.style.height = `${actualLineHeight}px`;
                
                // Clear all classes first, then add the correct ones
                highlight.className = '';
                highlight.className = `line-highlight ${type} active`;
            } else {
                highlight.className = 'line-highlight';
            }
        }

        // Function to clear line highlight
        function clearHighlight() {
            const highlight = document.getElementById('lineHighlight');
            highlight.className = 'line-highlight';
        }

        // Function to extract line number from error/warning message
        function extractLineNumber(message) {
            const match = message.match(/Line (\d+):/);
            return match ? parseInt(match[1]) : null;
        }

        function displayResults(result) {
            const resultsDiv = document.getElementById('results');
            
            if (result.valid) {
                resultsDiv.innerHTML = `
                    <div class="success">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.061L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                            </svg>
                            <span class="status valid">✓ Valid</span>
                        </div>
                        <strong>No syntax errors found!</strong><br>
                        Your HCL configuration appears to be syntactically correct.
                        ${result.warnings.length > 0 ? `<br><br><strong>Warnings:</strong>` : ''}
                    </div>
                    ${result.warnings.map(warning => {
                        const lineNumber = extractLineNumber(warning);
                        return `<div class="warning-item" 
                                    onmouseenter="highlightLine(${lineNumber}, 'warning')" 
                                    onmouseleave="clearHighlight()"
                                    data-line="${lineNumber}">⚠️ ${warning}</div>`;
                    }).join('')}
                `;
            } else {
                resultsDiv.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <span class="status error">✗ Invalid</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Found ${result.errors.length} error(s):</strong>
                    </div>
                    ${result.errors.map(error => {
                        const lineNumber = extractLineNumber(error);
                        return `<div class="error" 
                                    onmouseenter="highlightLine(${lineNumber}, 'error')" 
                                    onmouseleave="clearHighlight()"
                                    data-line="${lineNumber}">❌ ${error}</div>`;
                    }).join('')}
                    ${result.warnings.length > 0 ? `
                        <div style="margin-top: 20px; margin-bottom: 10px;">
                            <strong>Warnings:</strong>
                        </div>
                        ${result.warnings.map(warning => {
                            const lineNumber = extractLineNumber(warning);
                            return `<div class="warning-item" 
                                        onmouseenter="highlightLine(${lineNumber}, 'warning')" 
                                        onmouseleave="clearHighlight()"
                                        data-line="${lineNumber}">⚠️ ${warning}</div>`;
                        }).join('')}
                    ` : ''}
                `;
            }
        }

        // Function to update line numbers
        function updateLineNumbers() {
            const textarea = document.getElementById('hclInput');
            const lineNumbers = document.getElementById('lineNumbers');
            const lines = textarea.value.split('\n');
            const lineCount = lines.length;
            
            // Generate line numbers
            const numbers = [];
            for (let i = 1; i <= lineCount; i++) {
                numbers.push(i);
            }
            
            lineNumbers.textContent = numbers.join('\n');
            
            // Sync scroll position
            lineNumbers.scrollTop = textarea.scrollTop;
        }

        // Sync scroll between textarea and line numbers
        function syncScroll() {
            const textarea = document.getElementById('hclInput');
            const lineNumbers = document.getElementById('lineNumbers');
            
            lineNumbers.scrollTop = textarea.scrollTop;
            
            // Update highlight position if it's active
            if (document.getElementById('lineHighlight').classList.contains('active')) {
                // Re-trigger the highlight to update position
                const activeHighlight = document.querySelector('[data-line]:hover');
                if (activeHighlight) {
                    const lineNumber = parseInt(activeHighlight.getAttribute('data-line'));
                    const type = activeHighlight.classList.contains('error') ? 'error' : 'warning';
                    if (lineNumber) {
                        highlightLine(lineNumber, type);
                    }
                }
            }
        }

        // Event listeners
        document.getElementById('lintBtn').addEventListener('click', async () => {
            const hclCode = document.getElementById('hclInput').value;
            const result = await lintHCL(hclCode);
            displayResults(result);
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            document.getElementById('hclInput').value = '';
            updateLineNumbers();
            document.getElementById('results').innerHTML = `
                <div style="text-align: center; margin-top: 50px; color: #9ca3af;">
                    <svg width="48" height="48" fill="currentColor" viewBox="0 0 16 16" style="margin-bottom: 15px;">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                    </svg>
                    <p>Enter HCL configuration above and click "Lint HCL" to check for syntax errors</p>
                </div>
            `;
        });

        document.getElementById('exampleBtn').addEventListener('click', () => {
            const example = `# Example Terraform Configuration
terraform {
  required_version = ">= 1.0"
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = var.aws_region
}

variable "aws_region" {
  description = "AWS region for resources"
  type        = string
  default     = "us-west-2"
}

variable "instance_count" {
  description = "Number of instances to create"
  type        = number
  default     = 2
}

data "aws_ami" "ubuntu" {
  most_recent = true
  owners      = ["099720109477"] # Canonical

  filter {
    name   = "name"
    values = ["ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*"]
  }
}

resource "aws_vpc" "main" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name        = "main-vpc"
    Environment = "production"
  }
}

resource "aws_subnet" "public" {
  count = var.instance_count

  vpc_id                  = aws_vpc.main.id
  cidr_block              = "10.0.\${count.index + 1}.0/24"
  availability_zone       = data.aws_availability_zones.available.names[count.index]
  map_public_ip_on_launch = true

  tags = {
    Name = "public-subnet-\${count.index + 1}"
  }
}

data "aws_availability_zones" "available" {
  state = "available"
}

resource "aws_internet_gateway" "main" {
  vpc_id = aws_vpc.main.id

  tags = {
    Name = "main-igw"
  }
}

resource "aws_security_group" "web" {
  name_prefix = "web-sg"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  ingress {
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name = "web-security-group"
  }
}

resource "aws_instance" "web" {
  count = var.instance_count

  ami                    = data.aws_ami.ubuntu.id
  instance_type          = "t3.micro"
  subnet_id              = aws_subnet.public[count.index].id
  vpc_security_group_ids = [aws_security_group.web.id]
  key_name              = aws_key_pair.web.key_name

  user_data = base64encode(templatefile("\${path.module}/user-data.sh", {
    hostname = "web-\${count.index + 1}"
  }))

  tags = {
    Name        = "web-server-\${count.index + 1}"
    Environment = "production"
  }
}

resource "aws_key_pair" "web" {
  key_name   = "web-servers"
  public_key = file("~/.ssh/id_rsa.pub")
}

locals {
  common_tags = {
    Project   = "web-infrastructure"
    ManagedBy = "terraform"
  }
}

output "instance_ips" {
  description = "Public IP addresses of web servers"
  value       = aws_instance.web[*].public_ip
}

output "vpc_id" {
  description = "ID of the VPC"
  value       = aws_vpc.main.id
}`;

            document.getElementById('hclInput').value = example;
            updateLineNumbers();
        });

        // Auto-lint on input (debounced)
        let timeout;
        document.getElementById('hclInput').addEventListener('input', () => {
            updateLineNumbers();
            clearTimeout(timeout);
            timeout = setTimeout(async () => {
                const hclCode = document.getElementById('hclInput').value;
                if (hclCode.trim()) {
                    const result = await lintHCL(hclCode);
                    displayResults(result);
                }
            }, 1000);
        });

        // Add scroll sync
        document.getElementById('hclInput').addEventListener('scroll', syncScroll);

        // Initialize line numbers
        updateLineNumbers();

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                document.getElementById('lintBtn').click();
            }
        });
    </script>
</body>
</html>